dist: trusty
sudo: required
services:
  - docker

env:
  global:
  - secure: Zh1rP+8mdcgmZU7uEsOHpzUIbqzXruklYvW+rK71M35EVbayl8TeATMnNnQRldRRdRG27DkIqOVqGmHn6jErcURs1OQXtHDiY/Ne1YosBlY3ca9hIpQ7mMowWR4c2bEOrCBUiNP/4u623gbvCN8Y+nreaAfy4Ej9eqaCgYa9RTfaFSWTThG+JYn3g8R20XH+/0PRwPO6PkDSGoTw9Tvao1dn32QRAiRY2hnh4Ncz9IacJVD2VMGPnokYSR/Actw7QKpb6dVp/ldA7ZKjWn4pGQCe3wCjwirLPBRus5wNGrzQZ2smkXabtUKHVmN/KQgeeNWBLuQRyqr45qJhAjZ/X2Ct+czFIRbmYdavfRO1mwYsdmcGj3jEM0AO3g+UKd2WE5RLwUcc+FHa1CtXRSFRwAzsWkyZ+cmEEenoIOWYoql2qJhRONyUwRgfGwXxMr/T2t5ALhhebyOOgsx7PilaivEVF7dhTxlZbNmHxdwB9kfYnHZnibdOHm36EKnbYJThJ1eMg5yXPcfcTsdyKkCeHp4xuPxsCWkkJHSxIhTJ52s9CW3aHlXxV2QP2VI/FqwbsJURsB9TGlkOrW0ESz/HfKwsT911KgzgSXr/yCy33EfpCDnYy+xfQSYf62RlK81yaQ3hPvEoP5KCJzSSFPUo6K8qZGOZpGnj2PA/wznA8yk=
  - secure: JxiLYRzjxnFgx9LFZSHaQHmicFu5RXPG8ATYR3PcQQ29HKd1cAjP98KXqt5FpwSrx5/UD5MG/WGvCvHkpq7UF/gzW1AC1yQt3dUtORY0LUOIDbbnitICSyy2vqu2e0pyoqN5fVel35TB+7XHe3Su5aHy5JMJt0h0Fwc7sSkxw733pd/tfgpYGo/2PPy0YEqMYfYfM3wd2RVyv/kN3mAgvn8ZJ6lR6epwZvgEoPwCPieE3AS3zFo3ME8QbNyzxzIeGjeDkPJiznLzEGXccpbUPHpzQ3OBTKkL+/ZBUeblJwMmGZ/vyKb5+K0HL1zq3D09QbQ2UMj5u/1Xni/lSsGIKvNLl5znL5l4rjF9JFO6Fh+fHH/PVxWQ2sdeKBLFGDbWHrHRJYuhOIk8ykkdLmlfu05dmrm4mV+NXamt0gyvbH+MYoeTrlQ6VX+5lKabrNGrCBxB2RGGDXnP1YDf9ArKFv68jJno3Jw+OpyZqa1+R5ulr51rEorsF7KXSlz+QVZWwL+Taa10yT83nih1DLOBarrz6r1Nfmv84JivPsY1c4D5frkPDXeDbiMGGJc3pnuCIiQdYJGak/CK0sCpRlh1cTAt+RLtGU0cvmVCqky/fs4Sqht+vhuVX3WUraJxC6ZTS8JJ6R9MJYhZDOOCZSrxg+aXhH2lyx/RRxBuEsn+9to=

before_install:
  - pwd
  - docker pull vrmpx/pykaldi-deps:latest
  - 'export TAG=`if [[ $TRAVIS_PULL_REQUEST == "false" ]] && [[ $TRAVIS_BRANCH == "master" ]]; then echo "latest"; else echo $TRAVIS_PULL_REQUEST_BRANCH; fi`'

install:
  - docker build -t vrmpx/pykaldi:$TAG -f $TRAVIS_BUILD_DIR/docker/Dockerfile.travis .

script:
  - 'docker run vrmpx/pykaldi:$TAG /bin/bash -c "cd /pykaldi/tests && ./test_all.sh"'

after_success:
  - |
    if [[ $TRAVIS_PULL_REQUEST == "false" ]];
      docker login -u $DOCKER_USER -p $DOCKER_PASS
  	  docker push vrmpx/pykaldi:$TAG
  	fi

# Don't notify when things fail
notifications:
  email: false